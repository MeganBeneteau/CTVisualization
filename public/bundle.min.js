'use strict';

/* App Module */

var phonecatApp = angular.module('svalbardApp', [
  'ngRoute',
  'svalbardMain',
]);

phonecatApp.config(['$routeProvider',
  function($routeProvider) {
    $routeProvider.
      when('/', {
        templateUrl: 'components/Main/main.html',
        controller: 'MainController'
      }).
      otherwise({
        redirectTo: '/'
      });
  }]);


var container;

var camera, scene, renderer;
var cameraCube, sceneCube;

var mesh, lightMesh, geometry;
var spheres = [];

var directionalLight, pointLight;

var mouseX = 0;
var mouseY = 0;

var rx = 5000;
var ry = 5000;

var windowHalfX = 640 / 2;
var windowHalfY = 480 / 2;


function init() {

  container = $('#main');

  camera = new THREE.PerspectiveCamera( 60, 640/480, 1, 100000 );
  camera.position.z = 3200;

  cameraCube = new THREE.PerspectiveCamera( 60, 640/480, 1, 100000 );

  scene = new THREE.Scene();
  sceneCube = new THREE.Scene();

  var geometry = new THREE.SphereBufferGeometry( 100, 32, 16 );

  var path = "assets/images/pisa/";
  var format = '.png';
  var urls = [
    path + 'px' + format, path + 'nx' + format,
    path + 'py' + format, path + 'ny' + format,
    path + 'pz' + format, path + 'nz' + format
  ];

  var textureCube = new THREE.CubeTextureLoader().load( urls );
  var material = new THREE.MeshBasicMaterial( { color: 0xffffff, envMap: textureCube } );

  for ( var i = 0; i < 500; i ++ ) {

    var mesh = new THREE.Mesh( geometry, material );

    mesh.position.x = Math.random() * 10000 - 5000;
    mesh.position.y = Math.random() * 10000 - 5000;
    mesh.position.z = Math.random() * 10000 - 5000;

    mesh.scale.x = mesh.scale.y = mesh.scale.z = Math.random() * 3 + 1;

    scene.add( mesh );

    spheres.push( mesh );

  }

  // Skybox

  var shader = THREE.ShaderLib[ "cube" ];
  shader.uniforms[ "tCube" ].value = textureCube;

  var material = new THREE.ShaderMaterial( {

    fragmentShader: shader.fragmentShader,
    vertexShader: shader.vertexShader,
    uniforms: shader.uniforms,
    depthWrite: false,
    side: THREE.BackSide

  } ),

  mesh = new THREE.Mesh( new THREE.BoxGeometry( 100, 100, 100 ), material );
  sceneCube.add( mesh );

  //

  renderer = new THREE.WebGLRenderer();
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize( 640, 480 );
  renderer.autoClear = false;
  renderer.domElement.setAttribute('id', 'canvas');
  container.append( renderer.domElement );

  //

  window.addEventListener( 'resize', onWindowResize, false );

}

function onWindowResize() {

  windowHalfX = 640 / 2;
  windowHalfY = 480 / 2;

  camera.aspect = 640/480;
  camera.updateProjectionMatrix();

  cameraCube.aspect = 640/480;
  cameraCube.updateProjectionMatrix();


  renderer.setSize( 640, 480 );

}

function onDocumentMouseMove( event ) {

  mouseX = ( event.clientX - 640 ) * 10;
  mouseY = ( event.clientY - 480 ) * 10;

}

function animate() {

  requestAnimationFrame( animate );

  render();

}

function render() {

  var timer = 0.0001 * Date.now();

  for ( var i = 0, il = spheres.length; i < il; i ++ ) {

    var sphere = spheres[ i ];

    sphere.position.x = rx * Math.cos( timer + i );
    sphere.position.y = ry * Math.sin( timer + i * 1.1 );

  }

  camera.position.x += ( mouseX - camera.position.x ) * 0.05;
  camera.position.y += ( - mouseY - camera.position.y ) * 0.05;

  camera.lookAt( scene.position );
  cameraCube.rotation.copy( camera.rotation );

  renderer.render( sceneCube, cameraCube );
  renderer.render( scene, camera );

}


$(document).on('readyForCanvas', function(event) {
  console.log("readyForCanvas");
  init();
  animate();
  $("#canvas").on( 'mousemove', onDocumentMouseMove );
});

$(document).on('rotationValueChanged', function(event, x, y) {
  console.log('rotationValueChanged: ' + x + ', ' + y);
  rx = x;
  ry = y;
});


'use strict';

var main = angular.module('svalbardMain', []);

main.controller('MainController', ['$scope', function($scope) {
  $(document).trigger('readyForCanvas');

  $scope.updateRotation = function() {
    console.log("onClickRotationChanged");
    $(document).trigger('rotationValueChanged', [parseInt($scope.rotation.x), parseInt($scope.rotation.y)]);
  };
}]);


//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInRocmVlanMvZXhhbXBsZS5qcyIsImNvbXBvbmVudHMvTWFpbi9tYWluQ29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvVGhyZWVWaWV3ZXJDb21wb25lbnQvdmlld2VyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBSUEsSUFBQSxjQUFBLFFBQUEsT0FBQSxlQUFBO0VBQ0E7RUFDQTs7O0FBR0EsWUFBQSxPQUFBLENBQUE7RUFDQSxTQUFBLGdCQUFBO0lBQ0E7TUFDQSxLQUFBLEtBQUE7UUFDQSxhQUFBO1FBQ0EsWUFBQTs7TUFFQSxVQUFBO1FBQ0EsWUFBQTs7Ozs7QUNoQkEsSUFBQTs7QUFFQSxJQUFBLFFBQUEsT0FBQTtBQUNBLElBQUEsWUFBQTs7QUFFQSxJQUFBLE1BQUEsV0FBQTtBQUNBLElBQUEsVUFBQTs7QUFFQSxJQUFBLGtCQUFBOztBQUVBLElBQUEsU0FBQTtBQUNBLElBQUEsU0FBQTs7QUFFQSxJQUFBLEtBQUE7QUFDQSxJQUFBLEtBQUE7O0FBRUEsSUFBQSxjQUFBLE1BQUE7QUFDQSxJQUFBLGNBQUEsTUFBQTs7O0FBR0EsU0FBQSxPQUFBOztFQUVBLFlBQUEsRUFBQTs7RUFFQSxTQUFBLElBQUEsTUFBQSxtQkFBQSxJQUFBLElBQUEsS0FBQSxHQUFBO0VBQ0EsT0FBQSxTQUFBLElBQUE7O0VBRUEsYUFBQSxJQUFBLE1BQUEsbUJBQUEsSUFBQSxJQUFBLEtBQUEsR0FBQTs7RUFFQSxRQUFBLElBQUEsTUFBQTtFQUNBLFlBQUEsSUFBQSxNQUFBOztFQUVBLElBQUEsV0FBQSxJQUFBLE1BQUEsc0JBQUEsS0FBQSxJQUFBOztFQUVBLElBQUEsT0FBQTtFQUNBLElBQUEsU0FBQTtFQUNBLElBQUEsT0FBQTtJQUNBLE9BQUEsT0FBQSxRQUFBLE9BQUEsT0FBQTtJQUNBLE9BQUEsT0FBQSxRQUFBLE9BQUEsT0FBQTtJQUNBLE9BQUEsT0FBQSxRQUFBLE9BQUEsT0FBQTs7O0VBR0EsSUFBQSxjQUFBLElBQUEsTUFBQSxvQkFBQSxNQUFBO0VBQ0EsSUFBQSxXQUFBLElBQUEsTUFBQSxtQkFBQSxFQUFBLE9BQUEsVUFBQSxRQUFBOztFQUVBLE1BQUEsSUFBQSxJQUFBLEdBQUEsSUFBQSxLQUFBLE9BQUE7O0lBRUEsSUFBQSxPQUFBLElBQUEsTUFBQSxNQUFBLFVBQUE7O0lBRUEsS0FBQSxTQUFBLElBQUEsS0FBQSxXQUFBLFFBQUE7SUFDQSxLQUFBLFNBQUEsSUFBQSxLQUFBLFdBQUEsUUFBQTtJQUNBLEtBQUEsU0FBQSxJQUFBLEtBQUEsV0FBQSxRQUFBOztJQUVBLEtBQUEsTUFBQSxJQUFBLEtBQUEsTUFBQSxJQUFBLEtBQUEsTUFBQSxJQUFBLEtBQUEsV0FBQSxJQUFBOztJQUVBLE1BQUEsS0FBQTs7SUFFQSxRQUFBLE1BQUE7Ozs7OztFQU1BLElBQUEsU0FBQSxNQUFBLFdBQUE7RUFDQSxPQUFBLFVBQUEsVUFBQSxRQUFBOztFQUVBLElBQUEsV0FBQSxJQUFBLE1BQUEsZ0JBQUE7O0lBRUEsZ0JBQUEsT0FBQTtJQUNBLGNBQUEsT0FBQTtJQUNBLFVBQUEsT0FBQTtJQUNBLFlBQUE7SUFDQSxNQUFBLE1BQUE7Ozs7RUFJQSxPQUFBLElBQUEsTUFBQSxNQUFBLElBQUEsTUFBQSxhQUFBLEtBQUEsS0FBQSxPQUFBO0VBQ0EsVUFBQSxLQUFBOzs7O0VBSUEsV0FBQSxJQUFBLE1BQUE7RUFDQSxTQUFBLGVBQUEsT0FBQTtFQUNBLFNBQUEsU0FBQSxLQUFBO0VBQ0EsU0FBQSxZQUFBO0VBQ0EsU0FBQSxXQUFBLGFBQUEsTUFBQTtFQUNBLFVBQUEsUUFBQSxTQUFBOzs7O0VBSUEsT0FBQSxrQkFBQSxVQUFBLGdCQUFBOzs7O0FBSUEsU0FBQSxpQkFBQTs7RUFFQSxjQUFBLE1BQUE7RUFDQSxjQUFBLE1BQUE7O0VBRUEsT0FBQSxTQUFBLElBQUE7RUFDQSxPQUFBOztFQUVBLFdBQUEsU0FBQSxJQUFBO0VBQ0EsV0FBQTs7O0VBR0EsU0FBQSxTQUFBLEtBQUE7Ozs7QUFJQSxTQUFBLHFCQUFBLFFBQUE7O0VBRUEsU0FBQSxFQUFBLE1BQUEsVUFBQSxRQUFBO0VBQ0EsU0FBQSxFQUFBLE1BQUEsVUFBQSxRQUFBOzs7O0FBSUEsU0FBQSxVQUFBOztFQUVBLHVCQUFBOztFQUVBOzs7O0FBSUEsU0FBQSxTQUFBOztFQUVBLElBQUEsUUFBQSxTQUFBLEtBQUE7O0VBRUEsTUFBQSxJQUFBLElBQUEsR0FBQSxLQUFBLFFBQUEsUUFBQSxJQUFBLElBQUEsT0FBQTs7SUFFQSxJQUFBLFNBQUEsU0FBQTs7SUFFQSxPQUFBLFNBQUEsSUFBQSxLQUFBLEtBQUEsS0FBQSxRQUFBO0lBQ0EsT0FBQSxTQUFBLElBQUEsS0FBQSxLQUFBLEtBQUEsUUFBQSxJQUFBOzs7O0VBSUEsT0FBQSxTQUFBLEtBQUEsRUFBQSxTQUFBLE9BQUEsU0FBQSxNQUFBO0VBQ0EsT0FBQSxTQUFBLEtBQUEsRUFBQSxFQUFBLFNBQUEsT0FBQSxTQUFBLE1BQUE7O0VBRUEsT0FBQSxRQUFBLE1BQUE7RUFDQSxXQUFBLFNBQUEsTUFBQSxPQUFBOztFQUVBLFNBQUEsUUFBQSxXQUFBO0VBQ0EsU0FBQSxRQUFBLE9BQUE7Ozs7O0FBS0EsRUFBQSxVQUFBLEdBQUEsa0JBQUEsU0FBQSxPQUFBO0VBQ0EsUUFBQSxJQUFBO0VBQ0E7RUFDQTtFQUNBLEVBQUEsV0FBQSxJQUFBLGFBQUE7OztBQUdBLEVBQUEsVUFBQSxHQUFBLHdCQUFBLFNBQUEsT0FBQSxHQUFBLEdBQUE7RUFDQSxRQUFBLElBQUEsMkJBQUEsSUFBQSxPQUFBO0VBQ0EsS0FBQTtFQUNBLEtBQUE7Ozs7QUNoS0E7O0FBRUEsSUFBQSxPQUFBLFFBQUEsT0FBQSxnQkFBQTs7QUFFQSxLQUFBLFdBQUEsa0JBQUEsQ0FBQSxVQUFBLFNBQUEsUUFBQTtFQUNBLEVBQUEsVUFBQSxRQUFBOztFQUVBLE9BQUEsaUJBQUEsV0FBQTtJQUNBLFFBQUEsSUFBQTtJQUNBLEVBQUEsVUFBQSxRQUFBLHdCQUFBLENBQUEsU0FBQSxPQUFBLFNBQUEsSUFBQSxTQUFBLE9BQUEsU0FBQTs7OztBQ1ZBIiwiZmlsZSI6ImJ1bmRsZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG4vKiBBcHAgTW9kdWxlICovXHJcblxyXG52YXIgcGhvbmVjYXRBcHAgPSBhbmd1bGFyLm1vZHVsZSgnc3ZhbGJhcmRBcHAnLCBbXHJcbiAgJ25nUm91dGUnLFxyXG4gICdzdmFsYmFyZE1haW4nLFxyXG5dKTtcclxuXHJcbnBob25lY2F0QXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJyxcclxuICBmdW5jdGlvbigkcm91dGVQcm92aWRlcikge1xyXG4gICAgJHJvdXRlUHJvdmlkZXIuXHJcbiAgICAgIHdoZW4oJy8nLCB7XHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL01haW4vbWFpbi5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnTWFpbkNvbnRyb2xsZXInXHJcbiAgICAgIH0pLlxyXG4gICAgICBvdGhlcndpc2Uoe1xyXG4gICAgICAgIHJlZGlyZWN0VG86ICcvJ1xyXG4gICAgICB9KTtcclxuICB9XSk7XHJcbiIsIlxyXG52YXIgY29udGFpbmVyO1xyXG5cclxudmFyIGNhbWVyYSwgc2NlbmUsIHJlbmRlcmVyO1xyXG52YXIgY2FtZXJhQ3ViZSwgc2NlbmVDdWJlO1xyXG5cclxudmFyIG1lc2gsIGxpZ2h0TWVzaCwgZ2VvbWV0cnk7XHJcbnZhciBzcGhlcmVzID0gW107XHJcblxyXG52YXIgZGlyZWN0aW9uYWxMaWdodCwgcG9pbnRMaWdodDtcclxuXHJcbnZhciBtb3VzZVggPSAwO1xyXG52YXIgbW91c2VZID0gMDtcclxuXHJcbnZhciByeCA9IDUwMDA7XHJcbnZhciByeSA9IDUwMDA7XHJcblxyXG52YXIgd2luZG93SGFsZlggPSA2NDAgLyAyO1xyXG52YXIgd2luZG93SGFsZlkgPSA0ODAgLyAyO1xyXG5cclxuXHJcbmZ1bmN0aW9uIGluaXQoKSB7XHJcblxyXG4gIGNvbnRhaW5lciA9ICQoJyNtYWluJyk7XHJcblxyXG4gIGNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSggNjAsIDY0MC80ODAsIDEsIDEwMDAwMCApO1xyXG4gIGNhbWVyYS5wb3NpdGlvbi56ID0gMzIwMDtcclxuXHJcbiAgY2FtZXJhQ3ViZSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSggNjAsIDY0MC80ODAsIDEsIDEwMDAwMCApO1xyXG5cclxuICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gIHNjZW5lQ3ViZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuU3BoZXJlQnVmZmVyR2VvbWV0cnkoIDEwMCwgMzIsIDE2ICk7XHJcblxyXG4gIHZhciBwYXRoID0gXCJhc3NldHMvaW1hZ2VzL3Bpc2EvXCI7XHJcbiAgdmFyIGZvcm1hdCA9ICcucG5nJztcclxuICB2YXIgdXJscyA9IFtcclxuICAgIHBhdGggKyAncHgnICsgZm9ybWF0LCBwYXRoICsgJ254JyArIGZvcm1hdCxcclxuICAgIHBhdGggKyAncHknICsgZm9ybWF0LCBwYXRoICsgJ255JyArIGZvcm1hdCxcclxuICAgIHBhdGggKyAncHonICsgZm9ybWF0LCBwYXRoICsgJ256JyArIGZvcm1hdFxyXG4gIF07XHJcblxyXG4gIHZhciB0ZXh0dXJlQ3ViZSA9IG5ldyBUSFJFRS5DdWJlVGV4dHVyZUxvYWRlcigpLmxvYWQoIHVybHMgKTtcclxuICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBlbnZNYXA6IHRleHR1cmVDdWJlIH0gKTtcclxuXHJcbiAgZm9yICggdmFyIGkgPSAwOyBpIDwgNTAwOyBpICsrICkge1xyXG5cclxuICAgIHZhciBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xyXG5cclxuICAgIG1lc2gucG9zaXRpb24ueCA9IE1hdGgucmFuZG9tKCkgKiAxMDAwMCAtIDUwMDA7XHJcbiAgICBtZXNoLnBvc2l0aW9uLnkgPSBNYXRoLnJhbmRvbSgpICogMTAwMDAgLSA1MDAwO1xyXG4gICAgbWVzaC5wb3NpdGlvbi56ID0gTWF0aC5yYW5kb20oKSAqIDEwMDAwIC0gNTAwMDtcclxuXHJcbiAgICBtZXNoLnNjYWxlLnggPSBtZXNoLnNjYWxlLnkgPSBtZXNoLnNjYWxlLnogPSBNYXRoLnJhbmRvbSgpICogMyArIDE7XHJcblxyXG4gICAgc2NlbmUuYWRkKCBtZXNoICk7XHJcblxyXG4gICAgc3BoZXJlcy5wdXNoKCBtZXNoICk7XHJcblxyXG4gIH1cclxuXHJcbiAgLy8gU2t5Ym94XHJcblxyXG4gIHZhciBzaGFkZXIgPSBUSFJFRS5TaGFkZXJMaWJbIFwiY3ViZVwiIF07XHJcbiAgc2hhZGVyLnVuaWZvcm1zWyBcInRDdWJlXCIgXS52YWx1ZSA9IHRleHR1cmVDdWJlO1xyXG5cclxuICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoIHtcclxuXHJcbiAgICBmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLFxyXG4gICAgdmVydGV4U2hhZGVyOiBzaGFkZXIudmVydGV4U2hhZGVyLFxyXG4gICAgdW5pZm9ybXM6IHNoYWRlci51bmlmb3JtcyxcclxuICAgIGRlcHRoV3JpdGU6IGZhbHNlLFxyXG4gICAgc2lkZTogVEhSRUUuQmFja1NpZGVcclxuXHJcbiAgfSApLFxyXG5cclxuICBtZXNoID0gbmV3IFRIUkVFLk1lc2goIG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMTAwLCAxMDAsIDEwMCApLCBtYXRlcmlhbCApO1xyXG4gIHNjZW5lQ3ViZS5hZGQoIG1lc2ggKTtcclxuXHJcbiAgLy9cclxuXHJcbiAgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xyXG4gIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICk7XHJcbiAgcmVuZGVyZXIuc2V0U2l6ZSggNjQwLCA0ODAgKTtcclxuICByZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcclxuICByZW5kZXJlci5kb21FbGVtZW50LnNldEF0dHJpYnV0ZSgnaWQnLCAnY2FudmFzJyk7XHJcbiAgY29udGFpbmVyLmFwcGVuZCggcmVuZGVyZXIuZG9tRWxlbWVudCApO1xyXG5cclxuICAvL1xyXG5cclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplLCBmYWxzZSApO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gb25XaW5kb3dSZXNpemUoKSB7XHJcblxyXG4gIHdpbmRvd0hhbGZYID0gNjQwIC8gMjtcclxuICB3aW5kb3dIYWxmWSA9IDQ4MCAvIDI7XHJcblxyXG4gIGNhbWVyYS5hc3BlY3QgPSA2NDAvNDgwO1xyXG4gIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XHJcblxyXG4gIGNhbWVyYUN1YmUuYXNwZWN0ID0gNjQwLzQ4MDtcclxuICBjYW1lcmFDdWJlLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHJcblxyXG4gIHJlbmRlcmVyLnNldFNpemUoIDY0MCwgNDgwICk7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBvbkRvY3VtZW50TW91c2VNb3ZlKCBldmVudCApIHtcclxuXHJcbiAgbW91c2VYID0gKCBldmVudC5jbGllbnRYIC0gNjQwICkgKiAxMDtcclxuICBtb3VzZVkgPSAoIGV2ZW50LmNsaWVudFkgLSA0ODAgKSAqIDEwO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gYW5pbWF0ZSgpIHtcclxuXHJcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBhbmltYXRlICk7XHJcblxyXG4gIHJlbmRlcigpO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyKCkge1xyXG5cclxuICB2YXIgdGltZXIgPSAwLjAwMDEgKiBEYXRlLm5vdygpO1xyXG5cclxuICBmb3IgKCB2YXIgaSA9IDAsIGlsID0gc3BoZXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHtcclxuXHJcbiAgICB2YXIgc3BoZXJlID0gc3BoZXJlc1sgaSBdO1xyXG5cclxuICAgIHNwaGVyZS5wb3NpdGlvbi54ID0gcnggKiBNYXRoLmNvcyggdGltZXIgKyBpICk7XHJcbiAgICBzcGhlcmUucG9zaXRpb24ueSA9IHJ5ICogTWF0aC5zaW4oIHRpbWVyICsgaSAqIDEuMSApO1xyXG5cclxuICB9XHJcblxyXG4gIGNhbWVyYS5wb3NpdGlvbi54ICs9ICggbW91c2VYIC0gY2FtZXJhLnBvc2l0aW9uLnggKSAqIDAuMDU7XHJcbiAgY2FtZXJhLnBvc2l0aW9uLnkgKz0gKCAtIG1vdXNlWSAtIGNhbWVyYS5wb3NpdGlvbi55ICkgKiAwLjA1O1xyXG5cclxuICBjYW1lcmEubG9va0F0KCBzY2VuZS5wb3NpdGlvbiApO1xyXG4gIGNhbWVyYUN1YmUucm90YXRpb24uY29weSggY2FtZXJhLnJvdGF0aW9uICk7XHJcblxyXG4gIHJlbmRlcmVyLnJlbmRlciggc2NlbmVDdWJlLCBjYW1lcmFDdWJlICk7XHJcbiAgcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhICk7XHJcblxyXG59XHJcblxyXG5cclxuJChkb2N1bWVudCkub24oJ3JlYWR5Rm9yQ2FudmFzJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICBjb25zb2xlLmxvZyhcInJlYWR5Rm9yQ2FudmFzXCIpO1xyXG4gIGluaXQoKTtcclxuICBhbmltYXRlKCk7XHJcbiAgJChcIiNjYW52YXNcIikub24oICdtb3VzZW1vdmUnLCBvbkRvY3VtZW50TW91c2VNb3ZlICk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ3JvdGF0aW9uVmFsdWVDaGFuZ2VkJywgZnVuY3Rpb24oZXZlbnQsIHgsIHkpIHtcclxuICBjb25zb2xlLmxvZygncm90YXRpb25WYWx1ZUNoYW5nZWQ6ICcgKyB4ICsgJywgJyArIHkpO1xyXG4gIHJ4ID0geDtcclxuICByeSA9IHk7XHJcbn0pO1xyXG4iLCJcclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIG1haW4gPSBhbmd1bGFyLm1vZHVsZSgnc3ZhbGJhcmRNYWluJywgW10pO1xyXG5cclxubWFpbi5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgJChkb2N1bWVudCkudHJpZ2dlcigncmVhZHlGb3JDYW52YXMnKTtcclxuXHJcbiAgJHNjb3BlLnVwZGF0ZVJvdGF0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIm9uQ2xpY2tSb3RhdGlvbkNoYW5nZWRcIik7XHJcbiAgICAkKGRvY3VtZW50KS50cmlnZ2VyKCdyb3RhdGlvblZhbHVlQ2hhbmdlZCcsIFtwYXJzZUludCgkc2NvcGUucm90YXRpb24ueCksIHBhcnNlSW50KCRzY29wZS5yb3RhdGlvbi55KV0pO1xyXG4gIH07XHJcbn1dKTtcclxuIiwiIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
